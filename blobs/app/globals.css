/* ===== iOS 26 金色透明泡泡主題：統一變數、字體、層次、排版 ===== */

/* 全域變數（亮色） */
:root {
  --ui-scale: 1;
  --ui-font-scale: 1;
  /* 香檳金系 */
  --gold-50:  rgba(253, 246, 231, 0.75);
  --gold-100: rgba(250, 236, 205, 0.85);
  --gold-200: #F4E3B0;
  --gold-300: #EBCB7E;  /* 次要實色 */
  --gold-400: #E5BB5E;
  --gold-500: #DDAA3C;  /* 主色（亮） */
  --gold-600: #C9972F;  /* 主色（常用描邊/強調） */
  --gold-700: #A87628;  /* 深金（暗面/hover） */

  /* 玻璃層次 */
  --glass-bg: rgba(255,255,255,0.42);
  --glass-border: rgba(255,255,255,0.55);
  --glass-inset: rgba(255,255,255,0.58);
  --glass-shadow: 0 12px 36px rgba(16,24,40,0.18);
  --blur-strong: blur(28px) saturate(1.15);
  --blur-mid: blur(18px) saturate(1.1);

  /* 文字 */
  --txt-strong: #0d1117;
  --txt-soft: rgba(15, 23, 42, 0.7);

  /* 版面 */
  --radius-xl: 24px;
  --radius-lg: 18px;
  --radius-md: 14px;
  --radius-pill: 999px;

  /* 控制鈕/重點按鈕 */
  --btn-grad-start: #F8E6B9;   /* 金色高光 */
  --btn-grad-end:   #E7C36A;   /* 金色本體 */
  --btn-txt: #14171f;

  /* 輔助背景暈光 */
  --bg-aurora-1: rgba(240, 200, 120, 0.18);
  --bg-aurora-2: rgba(120, 190, 255, 0.10);

  /* 捲軸 */
  --scrollbar: rgba(0,0,0,0.14);
}

/* 暗色主題變數 */
@media (prefers-color-scheme: dark) {
  :root {
    --gold-50:  rgba(255, 249, 231, 0.5);
    --gold-100: rgba(253, 240, 200, 0.45);
    --gold-200: #EED99A;
    --gold-300: #E7C36A;
    --gold-400: #D9AE52;
    --gold-500: #C79A3A;
    --gold-600: #B3852F;
    --gold-700: #8C6726;

    --glass-bg: rgba(16,18,27,0.45);
    --glass-border: rgba(255,255,255,0.10);
    --glass-inset: rgba(255,255,255,0.06);
    --glass-shadow: 0 16px 44px rgba(0,0,0,0.45);

    --txt-strong: #E7EAF0;
    --txt-soft: rgba(236, 244, 255, 0.68);

    --btn-grad-start: #F0D38A;
    --btn-grad-end:   #D5A93E;
    --btn-txt: #0b0d12;

    --bg-aurora-1: rgba(215, 165, 70, 0.15);
    --bg-aurora-2: rgba(80, 150, 220, 0.10);

    --scrollbar: rgba(255,255,255,0.18);
  }
}

/* ===== Reset 與字體 ===== */
html, body, main {
  width: 100%;
  height: 100%;
  overflow: hidden;
  margin: 0;
  position: relative;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

* { box-sizing: border-box; }

body {
  font: 14px/1.5 ui-sans-serif, system-ui, -apple-system, "SF Pro Text",
        "Segoe UI", Roboto, "Noto Sans TC", Arial, "Microsoft JhengHei", sans-serif;
  font-size: calc(14px * var(--ui-font-scale));
  letter-spacing: .2px;
  color: var(--txt-strong);
}

/* ===== 版面與背景 ===== */
.app-container {
  display: grid;
  grid-template-columns: 1fr;
  grid-auto-rows: 1fr;
  gap: calc(20px * var(--ui-scale));
  height: 100vh;
  padding: calc(18px * var(--ui-scale));
  align-items: stretch;
  background:
    radial-gradient(1200px 800px at 10% 0%, var(--bg-aurora-1), transparent 60%),
    radial-gradient(900px 600px at 100% 100%, var(--bg-aurora-2), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,0.86), rgba(255,255,255,0.62));
}

@media (prefers-color-scheme: dark) {
  .app-container {
    background:
      radial-gradient(1200px 800px at 6% 0%, var(--bg-aurora-1), transparent 60%),
      radial-gradient(900px 600px at 100% 100%, var(--bg-aurora-2), transparent 60%),
      linear-gradient(180deg, #0b0c10, #0f1116);
  }
}

.app-container:has(.right-panel) {
  grid-template-columns: 1fr minmax(340px, 420px);
}

.left-panel,
.right-panel { min-height: 0; }

.left-panel {
  position: relative;
  border-radius: var(--radius-xl);
  overflow: hidden;
  background: #000;
}

.left-panel > :first-child {
  position: absolute; inset: 0; width: 100%; height: 100%;
  transform: scale(calc(0.6 * var(--ui-scale)));
}

/* ===== 玻璃卡（統一材質） ===== */
.glass-panel {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: calc(20px * var(--ui-scale));
  border-radius: calc(24px * var(--ui-scale));
  padding: calc(28px * var(--ui-scale)) calc(26px * var(--ui-scale)) calc(36px * var(--ui-scale));
  background: rgba(255, 255, 255, 0.05);
  box-shadow:
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.5),
    inset 0px 0px 15px rgba(255, 255, 255, 0.2),
    inset 0px 15px 30px rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
}

/* 次玻璃（header 條） */
.glass-subtle {
  padding: 8px 10px;
  border-radius: var(--radius-md);
  background: linear-gradient(180deg, rgba(255,255,255,0.55), rgba(255,255,255,0.32));
  border: 1px solid var(--glass-border);
  box-shadow: inset 0 1px var(--glass-inset);
}
@media (prefers-color-scheme: dark) {
  .glass-subtle {
    background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
  }
}

/* ===== 控制鈕列（玻璃態設計） ===== */
.controls {
  position: absolute;
  bottom: calc(40px * var(--ui-scale));
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: calc(16px * var(--ui-scale));
  z-index: 100;
}

.controls button {
  /* 玻璃態核心樣式 */
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border-radius: 69px;
  border: none;

  /* 多層陰影效果 */
  box-shadow:
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.5),
    inset 0px 0px 15px rgba(255, 255, 255, 0.2),
    inset 0px 15px 30px rgba(255, 255, 255, 0.2);

  padding: calc(8px * var(--ui-scale)) calc(16px * var(--ui-scale));
  color: rgba(255, 255, 255, 0.9);
  font-weight: 600;
  font-size: calc(14px * var(--ui-font-scale));
  cursor: pointer;
  transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
}

.controls button:hover {
  transform: translateY(-1px);
  filter: brightness(1.15);
  box-shadow:
    0px 6px 8px rgba(0, 0, 0, 0.3),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.6),
    inset 0px 0px 15px rgba(255, 255, 255, 0.25),
    inset 0px 15px 30px rgba(255, 255, 255, 0.25);
}

.controls button.active {
  background: rgba(233, 190, 96, 0.15);
  box-shadow:
    0 0 24px rgba(233, 190, 96, 0.4),
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(233, 190, 96, 0.3),
    inset 0px 1px 1px rgba(255, 255, 255, 0.6),
    inset 0px 0px 15px rgba(255, 255, 255, 0.3),
    inset 0px 15px 30px rgba(255, 255, 255, 0.3);
  color: rgba(255, 255, 255, 1);
}

@media (prefers-color-scheme: dark) {
  .controls button {
    color: rgba(255, 255, 255, 0.85);
  }
}

/* 狀態膠囊 */
.status-indicator {
  position: absolute;
  top: calc(40px * var(--ui-scale));
  left: 50%;
  transform: translateX(-50%);
  padding: calc(10px * var(--ui-scale)) calc(22px * var(--ui-scale));
  background: rgba(0,0,0,0.45);
  color: #fff;
  border: 1px solid rgba(255,255,255,0.28);
  border-radius: calc(18px * var(--ui-scale));
  font-size: calc(13px * var(--ui-font-scale));
  font-weight: 600;
  letter-spacing: .2px;
  backdrop-filter: var(--blur-mid);
  z-index: 100;
}

/* ===== 左側貼紙泡泡（選擇性：金色透明化） ===== */
.message-bubble svg {
  display: none; /* 暫時隱藏 SVG，讓內容決定高度 */
  width: 100%;
  height: auto;
  filter: drop-shadow(0 8px 22px rgba(0,0,0,0.22));
}

/* SVG viewBox 與裁切框座標（對齊 SplineViewer.tsx 的 rect） */
.message-bubble {
  --vb-w: 520;    /* viewBox 寬度 */
  --vb-h: 280;    /* viewBox 高度 */
  --box-x: 44;    /* rect x 座標 */
  --box-y: 46;    /* rect y 座標 */
  --box-w: 408;   /* rect 寬度 */
  --box-h: 110;   /* rect 高度 */
}

/* 容器撐滿 SVG，並套用 clip-path */
.message-bubble__content {
  position: relative;
  box-sizing: border-box;
  padding: 0;
  pointer-events: none;  /* 讓點擊事件穿透到內層 */
  flex: 1;
  display: flex;
  flex-direction: column;
}

/* ✅ 使用 CSS clip-path 遮罩文字區域 */
.message-bubble__clipped {
  clip-path: url(#text-clip-path);
  -webkit-clip-path: url(#text-clip-path);
}

/* 真正可滾動的文字區，使用固定像素值對齊 SVG */
.message-bubble__scrollable {
  position: relative;
  width: calc(396px * var(--ui-scale)); /* 440px - padding 左右各 22px */
  max-height: calc(280px * var(--ui-scale)); /* 足夠顯示初始內容（標題+分隔+三個按鈕），純文字超過四行時滾動 */
  padding: calc(12px * var(--ui-scale))
           calc(22px * var(--ui-scale))
           calc(20px * var(--ui-scale));
  margin: calc(20px * var(--ui-scale)) calc(12px * var(--ui-scale));

  overflow-y: auto;
  overflow-x: hidden;
  scroll-behavior: smooth;
  pointer-events: auto;

  /* 文字設定 */
  font-family: 'Noto Looped Thai', system-ui, -apple-system, "Noto Sans TC", Arial, "Microsoft JhengHei", sans-serif;
  font-style: normal;
  font-weight: 600;
  font-size: calc(16px * var(--ui-font-scale));
  line-height: calc(19px * var(--ui-font-scale));
  text-align: center;
  color: #FFFFFF;
  text-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);
  white-space: pre-wrap;
  word-wrap: break-word;
  word-break: break-word;
  box-sizing: border-box;
}

.message-bubble__default {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: calc(10px * var(--ui-scale));
  width: 100%;
}

.message-bubble__headline {
  font-weight: 700;
  font-size: calc(18px * var(--ui-font-scale));
  letter-spacing: .3px;
  line-height: 1.35;
  margin: 0;
  transition: opacity 0.3s ease-in-out;
}

.message-bubble__divider {
  font-weight: 600;
  font-size: calc(13px * var(--ui-font-scale));
  letter-spacing: calc(4px * var(--ui-scale));
  line-height: 1;
  margin: 0;
}

.message-bubble__buttons {
  width: 100%;
  display: flex;
  flex-direction: column;
  gap: calc(8px * var(--ui-scale));
}

.message-bubble__button {
  width: 100%;
  padding: calc(10px * var(--ui-scale)) calc(18px * var(--ui-scale));
  border-radius: calc(14px * var(--ui-scale));
  border: 1px solid rgba(255, 255, 255, 0.28);
  background: rgba(0, 0, 0, 0.35);
  color: #FFFFFF;
  font-weight: 500;
  font-size: calc(14px * var(--ui-font-scale));
  letter-spacing: .2px;
  text-align: center;
  cursor: pointer;
  box-shadow:
    inset 0 1px rgba(255, 255, 255, 0.3),
    0 2px 6px rgba(0, 0, 0, 0.22);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  transition: background .18s ease, transform .18s ease, box-shadow .18s ease;
}

.message-bubble__button:hover {
  background: rgba(255, 255, 255, 0.12);
  transform: translateY(-1px);
  box-shadow:
    inset 0 1px rgba(255, 255, 255, 0.35),
    0 4px 10px rgba(0, 0, 0, 0.28);
}

.message-bubble__button:active {
  transform: translateY(0);
  box-shadow:
    inset 0 1px rgba(255, 255, 255, 0.25),
    0 2px 6px rgba(0, 0, 0, 0.22);
}

.message-bubble__button:focus-visible {
  outline: 2px solid rgba(255, 255, 255, 0.6);
  outline-offset: 2px;
}

.message-bubble__scrollable::-webkit-scrollbar {
  width: 4px;
}

.message-bubble__scrollable::-webkit-scrollbar-thumb {
  background: rgba(179, 133, 47, 0.4);
  border-radius: 2px;
}

/* 泡泡內的訊息項目 */
.bubble-message-item {
  margin-bottom: 8px;
  line-height: 1.5;
}

.bubble-message-item:last-child {
  margin-bottom: 0;
}

.bubble-message-role {
  font-weight: 600;
  margin-right: 4px;
  color: #8B6914;
}

.bubble-message-text {
  color: #2c1810;
}

.message-bubble {
  position: absolute;
  top: calc(50% + (120px * var(--ui-scale))); /* 固定氣泡上緣位置 */
  left: 50%;
  transform: translateX(-50%);
  width: min(90%, calc(460px * var(--ui-scale)));
  max-height: calc(320px * var(--ui-scale)); /* 限制最大高度避免超出畫面 */
  z-index: 99;
  animation: bubbleIn .4s cubic-bezier(0.34,1.56,0.64,1);

  /* 自適應高度 */
  display: flex;
  flex-direction: column;
  min-height: fit-content;

  /* Glassmorphism styling - 平衡透明度讓文字清晰 */
  background: rgba(255, 255, 255, 0.08);
  box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25),
              inset 0px 0px 2px rgba(0, 0, 0, 0.25),
              inset 0px 1px 1px rgba(255, 255, 255, 0.5),
              inset 0px 0px 15px rgba(255, 255, 255, 0.2),
              inset 0px 15px 30px rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  border-radius: 7px;
}
@keyframes bubbleIn { 0%{opacity:0; transform: translateX(-50%) scale(.8) translateY(20px);} 100%{opacity:1; transform: translateX(-50%) scale(1) translateY(0);} }

/* 當展開歷史對話時隱藏訊息氣泡 */
.app-container:has(.right-panel) .message-bubble {
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

/* ===== 右側聊天 ===== */
.chat-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: calc(2px * var(--ui-scale)) calc(6px * var(--ui-scale));
  color: rgba(255, 255, 255, 0.82);
}

.chat-header h2 {
  margin: 0;
  font-weight: 600;
  font-size: calc(15px * var(--ui-font-scale));
  letter-spacing: .3px;
}

.chat-messages {
  flex: 1;
  padding: 0 calc(2px * var(--ui-scale));
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: calc(14px * var(--ui-scale));
  scrollbar-width: thin; scrollbar-color: var(--scrollbar) transparent;
}
.chat-messages::-webkit-scrollbar { width: 8px; }
.chat-messages::-webkit-scrollbar-thumb { background: var(--scrollbar); border-radius: 20px; }

/* 訊息泡泡（統一金色材質）- 平衡透明度讓文字清晰 */
.message-bubble-glass {
  max-width: min(88%, calc(560px * var(--ui-scale)));
  padding: calc(14px * var(--ui-scale)) calc(18px * var(--ui-scale)) calc(30px * var(--ui-scale));
  border-radius: calc(18px * var(--ui-scale));
  position: relative;
  line-height: 1.55;
  font-size: calc(16px * var(--ui-font-scale));
  letter-spacing: .2px;
  background: rgba(255, 255, 255, 0.08);
  box-shadow:
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.5),
    inset 0px 0px 15px rgba(255, 255, 255, 0.2),
    inset 0px 15px 30px rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(35px);
  -webkit-backdrop-filter: blur(35px);
  border: 1px solid rgba(255, 255, 255, 0.28);
  color: rgba(255, 255, 255, 0.92);
  transition: transform .18s ease, box-shadow .18s ease, border-color .18s ease;
}
.message-bubble-glass:hover {
  transform: translateY(-1px);
  border-color: rgba(255, 255, 255, 0.4);
  box-shadow:
    0px 6px 10px rgba(0, 0, 0, 0.3),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.55),
    inset 0px 0px 16px rgba(255, 255, 255, 0.24),
    inset 0px 18px 32px rgba(255, 255, 255, 0.26);
}

.chat-message { display: flex; align-items: flex-end; }
.chat-message.user-message { justify-content: flex-end; }
.chat-message.ai-message { justify-content: flex-start; }

/* AI 泡泡：較透，暖金高光 */
.message-bubble-glass.is-ai {
  border-color: rgba(255, 255, 255, 0.32);
}
/* User 泡泡：金色薄霧 */
.message-bubble-glass.is-user {
  border-color: rgba(255, 255, 255, 0.24);
}

@media (prefers-color-scheme: dark) {
  .message-bubble-glass.is-ai {
    border-color: rgba(255, 255, 255, 0.3);
  }
  .message-bubble-glass.is-user {
    border-color: rgba(255, 255, 255, 0.22);
  }
}

.message-text {
  white-space: pre-wrap;
  word-break: break-word;
  padding-bottom: calc(4px * var(--ui-scale)); /* 為時間戳留出空間 */
  min-height: calc(18px * var(--ui-scale)); /* 確保有足夠高度 */
}
.message-time {
  position: absolute;
  bottom: calc(6px * var(--ui-scale));
  right: calc(10px * var(--ui-scale));
  font-size: calc(11px * var(--ui-font-scale));
  color: rgba(255, 255, 255, 0.55);
  pointer-events: none; /* 防止遮擋選取文字 */
  white-space: nowrap; /* 時間戳不換行 */
}

/* 輸入區（膠囊玻璃 + 金色主按鈕） */
.glass-input {
  margin-top: calc(10px * var(--ui-scale));
  display: grid; grid-template-columns: 1fr auto; gap: calc(8px * var(--ui-scale)); align-items: center;
  padding: calc(8px * var(--ui-scale)); border-radius: calc(16px * var(--ui-scale));
  background: linear-gradient(180deg, rgba(255,255,255,0.45), rgba(255,255,255,0.28));
  border: 1px solid var(--glass-border);
  box-shadow: inset 0 1px var(--glass-inset);
}
@media (prefers-color-scheme: dark) {
  .glass-input { background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03)); }
}

.chat-input {
  width: 100%; height: calc(42px * var(--ui-scale)); border: 0; outline: none; border-radius: var(--radius-pill);
  padding: 0 calc(14px * var(--ui-scale)); font-size: calc(16px * var(--ui-font-scale));
  background: rgba(255,255,255,0.75);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.8);
}
.chat-input::placeholder { color: rgba(0,0,0,0.35); }
@media (prefers-color-scheme: dark) {
  .chat-input { background: rgba(255,255,255,0.08); color: #E5E7EB; box-shadow: inset 0 1px 0 rgba(255,255,255,0.06); }
  .chat-input::placeholder { color: rgba(255,255,255,0.35); }
}

.send-button {
  height: calc(42px * var(--ui-scale));
  padding: 0 calc(20px * var(--ui-scale));
  border: none;
  cursor: pointer;
  font-weight: 700;
  font-size: calc(14px * var(--ui-font-scale));
  letter-spacing: .2px;

  /* 玻璃態核心樣式 */
  background: rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border-radius: 69px;

  /* 多層陰影效果 */
  box-shadow:
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.5),
    inset 0px 0px 15px rgba(255, 255, 255, 0.2),
    inset 0px 15px 30px rgba(255, 255, 255, 0.2);

  color: rgba(255, 255, 255, 0.9);
  transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
}

.send-button:hover {
  filter: brightness(1.15);
  transform: translateY(-1px);
  box-shadow:
    0px 6px 8px rgba(0, 0, 0, 0.3),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.6),
    inset 0px 0px 15px rgba(255, 255, 255, 0.25),
    inset 0px 15px 30px rgba(255, 255, 255, 0.25);
}

.send-button:active {
  transform: translateY(0);
  filter: brightness(1.0);
}

/* 聊天開關/麥克風（玻璃態設計） */
.chat-toggle-button,
.mic-button {
  position: absolute;
  padding: calc(6px * var(--ui-scale)) calc(16px * var(--ui-scale));
  font-size: calc(16px * var(--ui-font-scale));
  font-weight: 700;
  cursor: pointer;
  z-index: 100;

  /* 玻璃態核心樣式 */
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border-radius: 69px;
  border: none;

  /* 多層陰影效果 */
  box-shadow:
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.5),
    inset 0px 0px 15px rgba(255, 255, 255, 0.2),
    inset 0px 15px 30px rgba(255, 255, 255, 0.2);

  color: rgba(255, 255, 255, 0.9);
  transition: all .2s ease;
}

.chat-toggle-button { top: calc(40px * var(--ui-scale)); right: calc(40px * var(--ui-scale)); }
.mic-button { bottom: calc(40px * var(--ui-scale)); right: calc(40px * var(--ui-scale)); }

.chat-toggle-button:hover,
.mic-button:hover {
  transform: translateY(-1px);
  filter: brightness(1.15);
  box-shadow:
    0px 6px 8px rgba(0, 0, 0, 0.3),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.6),
    inset 0px 0px 15px rgba(255, 255, 255, 0.25),
    inset 0px 15px 30px rgba(255, 255, 255, 0.25);
}

.mic-button.recording {
  background: rgba(255, 90, 90, 0.15);
  box-shadow:
    0 0 20px rgba(255, 90, 90, 0.4),
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(255, 90, 90, 0.3),
    inset 0px 1px 1px rgba(255, 255, 255, 0.5),
    inset 0px 0px 15px rgba(255, 255, 255, 0.2),
    inset 0px 15px 30px rgba(255, 255, 255, 0.2);
}

/* 垂直音量視覺化：綠→金→橙（頂端微紅），與金色主題協調 */
.audio-visualizer-vertical {
  position: absolute; bottom: calc(110px * var(--ui-scale)); right: calc(40px * var(--ui-scale));
  width: calc(50px * var(--ui-scale)); height: calc(200px * var(--ui-scale)); display: flex; flex-direction: column-reverse; gap: calc(4px * var(--ui-scale));
  padding: calc(12px * var(--ui-scale));
  background: linear-gradient(180deg, rgba(255,255,255,0.5), rgba(255,255,255,0.18));
  border: 1px solid var(--glass-border);
  border-radius: calc(12px * var(--ui-scale));
  backdrop-filter: var(--blur-mid);
  z-index: 100;
}
.audio-level-bar {
  width: 100%; height: 100%; border-radius: calc(4px * var(--ui-scale)); transition: all .1s ease-out;
  background: rgba(120, 120, 120, 0.25);
  border: 1px solid rgba(255,255,255,0.12);
}
.audio-level-bar.active {
  background: linear-gradient(90deg, #7AE47A 0%, var(--gold-300) 100%);
  box-shadow: 0 0 10px rgba(233,190,96,0.55);
  border-color: rgba(233,190,96,0.45);
}
/* 中段偏金橙 */
.audio-level-bar:nth-child(8).active,
.audio-level-bar:nth-child(9).active {
  background: linear-gradient(90deg, var(--gold-400) 0%, #FFBE55 100%);
  box-shadow: 0 0 10px rgba(255,190,85,0.6);
  border-color: rgba(255,190,85,0.5);
}
/* 頂部微紅提示 */
.audio-level-bar:nth-child(10).active {
  background: linear-gradient(90deg, #FF7A7A 0%, #FF9A7A 100%);
  box-shadow: 0 0 10px rgba(255, 122, 122, 0.6);
  border-color: rgba(255, 122, 122, 0.5);
}

/* ===== Logo 容器 ===== */
.logo-container {
  position: absolute;
  top: calc(40px * var(--ui-scale));
  left: calc(40px * var(--ui-scale));
  z-index: 100;
  width: calc(120px * var(--ui-scale));
}

.app-logo {
  height: calc(28px * var(--ui-scale));
  width: 100%;
  display: block;
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.15));
}

/* ===== 開始語音對話按鈕（玻璃態設計 - 參考設計稿） ===== */
.start-conversation-button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 100;

  /* 尺寸 - 完全參考設計稿 */
  width: calc(370px * var(--ui-scale));
  height: calc(46px * var(--ui-scale));

  /* 玻璃態核心樣式 - 完全參考設計稿 */
  background: rgba(255, 255, 255, 0.05);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border-radius: 69px;
  border: none;

  /* 多層陰影效果 - 完全參考設計稿 */
  box-shadow:
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(0, 0, 0, 0.25),
    inset 0px 1px 1px rgba(255, 255, 255, 0.5),
    inset 0px 0px 15px rgba(255, 255, 255, 0.2),
    inset 0px 15px 30px rgba(255, 255, 255, 0.2);

  /* 文字樣式 */
  color: rgba(255, 255, 255, 0.9);
  font-size: calc(16px * var(--ui-font-scale));
  font-weight: 600;
  letter-spacing: 0.3px;

  /* 互動 */
  cursor: pointer;

  /* 佈局 */
  display: flex;
  align-items: center;
  justify-content: center;
  gap: calc(8px * var(--ui-scale));
}

.start-conversation-button .mic-icon {
  font-size: calc(16px * var(--ui-font-scale));
}

.start-conversation-button .button-text {
  line-height: 1;
}

/* 麥克風圖示脈動動畫 */
@keyframes pulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.15);
    opacity: 0.85;
  }
}


/* ===== 結束對話按鈕（玻璃態設計） ===== */
.end-conversation-button {
  position: absolute;
  top: calc(80px * var(--ui-scale));
  left: calc(40px * var(--ui-scale));
  z-index: 100;

  /* 尺寸與排版 - 寬度再增加 20% */
  width: calc(173px * var(--ui-scale)); /* 144px × 1.2 = 172.8px ≈ 173px (原 120px 增加 44%) */
  height: calc(32px * var(--ui-scale));
  font-size: calc(13px * var(--ui-font-scale));
  font-weight: 700;
  letter-spacing: 0.3px;

  /* 玻璃態核心樣式 - 紅色調 */
  background: rgba(255, 90, 90, 0.12);
  backdrop-filter: blur(25px);
  -webkit-backdrop-filter: blur(25px);
  border-radius: calc(69px * var(--ui-scale));
  border: none;

  /* 多層陰影效果 */
  box-shadow:
    0 0 30px rgba(220, 53, 69, 0.4),
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(220, 53, 69, 0.3),
    inset 0px 1px 1px rgba(255, 255, 255, 0.5),
    inset 0px 0px 15px rgba(255, 255, 255, 0.2),
    inset 0px 15px 30px rgba(255, 255, 255, 0.2);

  color: rgba(255, 255, 255, 0.95);

  /* 互動效果 */
  cursor: pointer;
  transition: all 0.25s cubic-bezier(0.34, 1.56, 0.64, 1);

  /* 佈局 */
  display: flex;
  align-items: center;
  justify-content: center;
  gap: calc(6px * var(--ui-scale));
}

.end-conversation-button .end-icon {
  font-size: calc(14px * var(--ui-font-scale));
  animation: endPulse 1.5s ease-in-out infinite;
}

.end-conversation-button .button-text {
  line-height: 1;
}

.end-conversation-button:hover {
  transform: translateY(-2px) scale(1.03);
  filter: brightness(1.2);
  box-shadow:
    0 0 40px rgba(220, 53, 69, 0.5),
    0px 6px 8px rgba(0, 0, 0, 0.3),
    inset 0px 0px 2px rgba(220, 53, 69, 0.4),
    inset 0px 1px 1px rgba(255, 255, 255, 0.6),
    inset 0px 0px 15px rgba(255, 255, 255, 0.25),
    inset 0px 15px 30px rgba(255, 255, 255, 0.25);
}

.end-conversation-button:active {
  transform: translateY(0) scale(0.98);
  filter: brightness(1.0);
  box-shadow:
    0 0 25px rgba(220, 53, 69, 0.35),
    0px 4px 4px rgba(0, 0, 0, 0.25),
    inset 0px 0px 2px rgba(220, 53, 69, 0.3),
    inset 0px 1px 1px rgba(255, 255, 255, 0.4),
    inset 0px 0px 15px rgba(255, 255, 255, 0.15),
    inset 0px 15px 30px rgba(255, 255, 255, 0.15);
}

/* 結束圖示脈動動畫 */
@keyframes endPulse {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.2);
    opacity: 0.7;
  }
}

/* 暗色模式適配 */
@media (prefers-color-scheme: dark) {
  .end-conversation-button {
    border: 2px solid rgba(255, 255, 255, 0.3);
    box-shadow:
      0 12px 32px rgba(220, 53, 69, 0.3),
      0 6px 16px rgba(220, 53, 69, 0.25),
      inset 0 1px rgba(255, 255, 255, 0.25),
      inset 0 -1px rgba(0, 0, 0, 0.3);
  }

  .end-conversation-button:hover {
    box-shadow:
      0 16px 40px rgba(220, 53, 69, 0.4),
      0 8px 20px rgba(220, 53, 69, 0.35),
      inset 0 1px rgba(255, 255, 255, 0.35);
  }
}

/* 動畫偏好 */
@media (prefers-reduced-motion: reduce) {
  .message-bubble-glass, .send-button, .controls button { transition: none; }
  .start-conversation-button { animation: none; transition: none; }
  .start-conversation-button .mic-icon { animation: none; }
  .end-conversation-button { animation: none; transition: none; }
  .end-conversation-button .end-icon { animation: none; }
}

/* ========================================
   垂直佈局 RWD 樣式 (/vertical 路由專用)
   ======================================== */

/* 垂直佈局容器 - 使用 data attribute 標記 */
[data-layout="vertical"] {
  --vertical-offset: calc(-80px * var(--ui-scale)); /* 整體往上偏移量 */
  --spline-scale: 0.85; /* Spline 縮放比例 */
  --bubble-top-offset: calc(-60px * var(--ui-scale)); /* 對話氣泡往上偏移 */
  --logo-top: calc(30px * var(--ui-scale)); /* Logo 位置微調 */
  --end-button-top: calc(65px * var(--ui-scale)); /* 結束對話按鈕位置微調 */
}

/* 垂直佈局：背景改為純黑色 */
[data-layout="vertical"].app-container {
  background: #000000;
}

/* Spline 容器整體往上移 */
[data-layout="vertical"] .left-panel > :first-child {
  transform: translateY(var(--vertical-offset)) scale(var(--spline-scale));
}

/* SVG 倒影也需要同步往上移，並額外往下 20px */
[data-layout="vertical"] .glass-reflection {
  top: calc(50% + 180px + var(--vertical-offset) + 20px) !important;
}

/* 點按喚醒按鈕往上調整 */
[data-layout="vertical"] .start-conversation-button {
  top: calc(50% + var(--vertical-offset));
}

/* 對話氣泡框往上移 - 使用 top 定位固定上緣 */
[data-layout="vertical"] .message-bubble {
  top: calc(50% + 120px + var(--bubble-top-offset) - 15px); /* 固定上緣位置，再往上 15px */
}

/* Logo 位置微調 - 往左上角移動 */
[data-layout="vertical"] .logo-container {
  top: calc(8px * var(--ui-scale));
  left: calc(8px * var(--ui-scale));
}

/* 結束對話按鈕位置微調 - 往左上角移動 */
[data-layout="vertical"] .end-conversation-button {
  top: calc(48px * var(--ui-scale));
  left: calc(5px * var(--ui-scale));
}

/* 手機版響應式調整 */
@media (max-width: 768px) {
  [data-layout="vertical"] {
    --vertical-offset: calc(-100px * var(--ui-scale));
    --spline-scale: 0.75;
    --bubble-top-offset: calc(-80px * var(--ui-scale));
  }
}

/* 平板版響應式調整 */
@media (min-width: 769px) and (max-width: 1024px) {
  [data-layout="vertical"] {
    --vertical-offset: calc(-90px * var(--ui-scale));
    --spline-scale: 0.8;
    --bubble-top-offset: calc(-70px * var(--ui-scale));
  }
}

/* 垂直佈局隱藏控制按鈕 */
[data-layout="vertical"] .controls {
  display: none;
}

/* 垂直佈局隱藏系統狀態指示器 */
[data-layout="vertical"] .status-indicator {
  display: none;
}

/* 垂直佈局隱藏麥克風視覺化按鈕 */
[data-layout="vertical"] .mic-button {
  display: none;
}

/* 垂直佈局：音訊視覺化往右下角移動 - 與 logo 間距一致，並縮小尺寸 */
[data-layout="vertical"] .audio-visualizer-vertical {
  bottom: calc(3px * var(--ui-scale));
  right: calc(3px * var(--ui-scale));
  width: calc(20px * var(--ui-scale));
  height: calc(240px * var(--ui-scale));
  padding: calc(4px * var(--ui-scale));
  gap: calc(3px * var(--ui-scale));
}

/* 垂直佈局：歷史對話紀錄按鈕移至對話氣泡右上方 */
[data-layout="vertical"] .chat-toggle-button {
  top: calc(50% + 120px + var(--bubble-top-offset) - 48px - 15px); /* 氣泡上緣 - 按鈕高度(38px) - 間距(10px) - 往上15px */
  right: calc(50% - min(90%, calc(460px * var(--ui-scale))) / 2); /* 與氣泡框右緣對齊 */
  left: auto;
  bottom: auto;
  padding: calc(5px * var(--ui-scale)) calc(11px * var(--ui-scale)); /* 放大 20%: 4px*1.2≈5px, 9px*1.2≈11px */
  width: calc(50px * var(--ui-scale)); /* 放大 20%: 42px * 1.2 = 50.4px ≈ 50px */
  height: calc(38px * var(--ui-scale)); /* 放大 20%: 32px * 1.2 = 38.4px ≈ 38px */
  border-radius: calc(18px * var(--ui-scale)); /* 放大 20%: 15px * 1.2 = 18px */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* 圖示也放大 20% */
[data-layout="vertical"] .chat-toggle-button svg {
  width: calc(29px * var(--ui-scale)); /* 放大 20%: 24px * 1.2 = 28.8px ≈ 29px */
  height: calc(29px * var(--ui-scale));
  flex-shrink: 0;
}

/* 垂直佈局：對話歷史區塊全螢幕覆蓋 */
[data-layout="vertical"] .right-panel {
  position: fixed;
  top: calc(110px * var(--ui-scale)); /* 留出空間讓 X 按鈕在區塊外 (55px + 38px + 10px間距 + 32px按鈕高度 + -5px重疊) */
  left: calc(25px * var(--ui-scale)); /* 與結束對話按鈕左緣對齊 */
  right: calc(20px * var(--ui-scale)); /* 右側留邊距 */
  bottom: calc(20px * var(--ui-scale)); /* 底部也留邊距 */
  z-index: 200; /* 高於其他元素 */
  background: rgba(0, 0, 0, 0.25); /* 半透明黑色背景 */
  border-radius: calc(24px * var(--ui-scale));
  margin: 0;
  padding: calc(10px * var(--ui-scale)); /* 調整 padding，因為 X 按鈕在外面 */
}

/* 垂直佈局：調整 grid 佈局 - 對話歷史展開時不影響主體 */
[data-layout="vertical"].app-container:has(.right-panel) {
  grid-template-columns: 1fr; /* 保持單欄 */
}

/* 垂直佈局：關閉對話按鈕移至對話區塊外的右上角 */
[data-layout="vertical"] .right-panel .chat-header {
  position: absolute;
  top: calc(-46px * var(--ui-scale)); /* 區塊上方，按鈕高度 38px + 10px 間距 */
  right: 0; /* 與區塊右緣對齊 */
  left: auto;
  width: auto;
  padding: 0;
  background: transparent;
  z-index: 201; /* 高於對話區塊 */
}

/* 垂直佈局：隱藏標題文字，只保留關閉按鈕 */
[data-layout="vertical"] .chat-header h2 {
  display: none;
}

/* 垂直佈局：隱藏輸入訊息區域（目前用不到） */
[data-layout="vertical"] .chat-input-area {
  display: none;
}
